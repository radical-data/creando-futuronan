---
import SiteLayout from "../layouts/Layout.astro";
import Hero from "../components/home/Hero.astro";
import Programmes from "../components/home/Programmes.astro";
import WhatsHappening from "../components/home/WhatsHappening.astro";
import WhyCreando from "../components/home/WhyCreando.astro";
import Partners from "../components/home/Partners.astro";
import ClosingCTA from "../components/home/ClosingCTA.astro";
import UrgencyBanner from "../components/UrgencyBanner.svelte";
import heroImage from "../assets/hero.png";

import { getCollection } from "astro:content";

const programmes = (await getCollection("programmes")).map((p) => p.data);
const partnerCards = (await getCollection("partners")).map((p) => p.data);
const events = (await getCollection("events"))
  .map((e) => ({
    ...e.data,
    dateISO: e.data.dateISO.toISOString(),
  }))
  .sort(
    (a, b) => new Date(a.dateISO).getTime() - new Date(b.dateISO).getTime()
  );
const openCalls = (await getCollection("open-calls")).map((o) => o.data);

// Find active open call
const activeOpenCall = openCalls.find(call => {
  if (!call.openISO || !call.closeISO) return false;
  const now = new Date();
  const openDate = new Date(call.openISO);
  const closeDate = new Date(call.closeISO);
  return now >= openDate && now <= closeDate;
}) || null;

const headline = "Building futures from here, not elsewhere.";
const sub =
  "Creando Futuronan is a practical school for design and digital culture in Aruba. We equip young people and artists with the tools to imagine, build, and sustain futures rooted in Caribbean realities.";
---

<SiteLayout title="Creando Futuronan">
  <UrgencyBanner openCall={activeOpenCall} client:load />
  
  <Hero
    headline={headline}
    sub={sub}
    ctas={[
      { label: "Join Creando Spark", href: "/spark" },
      { label: "Apply to Creando Sustain", href: "/sustain" },
    ]}
    image={heroImage}
    muxPlaybackId="YbgUMhM7Hyd00NxY1bTW35AWn4oO5r3MgUcL71RHdTfU"
  />

  <!-- Programmes -->
  <Programmes cards={programmes} />

  <!-- What's happening now (Open Call or Events) -->
  <WhatsHappening openCall={activeOpenCall} events={events} />

  <!-- Why Creando -->
  <WhyCreando />

  <!-- Partners -->
  <Partners items={partnerCards} />

  <!-- Closing CTA -->
  <ClosingCTA />
</SiteLayout>
