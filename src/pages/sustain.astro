---
import ProgramLayout from "../layouts/ProgramLayout.astro";
import { getCollection } from "astro:content";
import { normaliseLocale, useTranslations } from "../i18n/utils";
import type { Lang } from "../i18n/ui";

const lang: Lang = normaliseLocale(Astro.currentLocale);
const t = useTranslations(lang);

function entryMatchesLocale(entryId: string, lang: Lang) {
  return entryId.startsWith(`${lang}/`);
}

// Load programme page content from collection
const programmePages = await getCollection("programme-pages");
const sustainPage = programmePages
  .find((page) => entryMatchesLocale(page.id, lang) && page.data.slug === "sustain");

if (!sustainPage) {
  throw new Error(`Sustain programme page not found for locale: ${lang}`);
}

const pageData = sustainPage.data;
---

<ProgramLayout
  title="Creando Sustain — Creando Futuronan"
  description="A school for building futures that actually last."
  headline={pageData.headline}
  sub={pageData.sub}
  ageRange="18–30"
  ctas={[
    { label: t("programme.applySustain"), href: "https://wa.me/2975689420" },
    { label: t("programme.introDetails"), href: "#intro" },
  ]}
  programColor="var(--color-sustain)"
  streamClass="stream-sustain"
  muxPlaybackId="2vMbR4rTrjrhhijGDRs6MfSBkjQdwFT02B02h7yIiYUVU"
  aboutContent={pageData.aboutContent}
  schedule={pageData.schedule}
  methodologies={pageData.methodologies}
  team={pageData.team}
  location={pageData.location}
  language={pageData.language}
  introSession={pageData.introSession}
  applicationInfo={pageData.applicationInfo}
  faqs={pageData.faqs}
/>
