---
import SiteLayout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { normaliseLocale, useTranslations } from "../i18n/utils";
import type { Lang } from "../i18n/ui";

const lang: Lang = normaliseLocale(Astro.currentLocale);
const t = useTranslations(lang);

function entryMatchesLocale(entryId: string, lang: Lang) {
  return entryId.startsWith(`${lang}/`);
}

// Load about page content from collection
const pages = await getCollection("pages");
const aboutPage = pages
  .find((page) => entryMatchesLocale(page.id, lang) && page.data.slug === "about");

if (!aboutPage) {
  throw new Error(`About page not found for locale: ${lang}`);
}

const pageData = aboutPage.data;

// Load partners from collection
const partnerCards = (await getCollection("partners"))
  .filter((p) => entryMatchesLocale(p.id, lang))
  .map((p) => p.data);
---

<SiteLayout
  title="About â€” Creando Futuronan"
  description="A practical school for creativity, built from the ground up in Aruba."
>
  <section class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 lg:py-14">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-12">
        <h1 class="h1">{pageData.title}</h1>
        <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[--color-lime]/20">
          <span class="w-2 h-2 rounded-full bg-[--color-lime]"></span>
          <span class="text-sm font-medium text-black/80">{pageData.badgeText}</span>
        </div>
      </div>
      
      <div class="prose prose-sm sm:prose lg:prose-lg max-w-none">
        <!-- Mission Statement -->
        <div class="not-prose mb-12 p-8 bg-gradient-to-br from-[--color-spark]/5 to-[--color-sustain]/5 rounded-3xl border border-black/10">
          <blockquote class="text-xl font-medium text-center italic">
            "{pageData.missionQuote}"
          </blockquote>
        </div>
        
        <div class="grid gap-8 md:grid-cols-2 mb-12">
          <div>
            <h2 class="h2 mb-4">{pageData.ourStory.heading}</h2>
            {pageData.ourStory.content.split('\n\n').map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </div>
          
          <div>
            <h2 class="h2 mb-4">{pageData.ourApproach.heading}</h2>
            {pageData.ourApproach.content.split('\n\n').map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </div>

        <h2 class="h2 mt-12" id="partners">{t("about.partners")}</h2>

        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3 mt-8">
          {partnerCards.map((partner) => (
            <div class="p-6 rounded-2xl border border-black/10 bg-white hover:shadow-lg transition-shadow">
              <h3 class="h3 mb-3">{partner.name}</h3>
              {partner.description && (
                <p class="text-sm text-black/75" set:html={partner.description}></p>
              )}
            </div>
          ))}
        </div>

      <p class="mt-8 text-sm text-black/70">
        {pageData.financingText}
      </p>
    </div>
  </section>
</SiteLayout>
