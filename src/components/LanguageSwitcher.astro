---
import { languages, type Lang } from "../i18n/ui";
import { getRelativeLocaleUrl } from "astro:i18n";

const { lang } = Astro.props as { lang: Lang };

const rawPath = Astro.url.pathname;

// For our simple site: map path to page id that matches existing routes
// "/" -> "", "/about" -> "about", "/spark" -> "spark", "/sustain" -> "sustain"
// Strip locale prefix if present (/en/about -> /about -> about)
const path = rawPath.replace(/^\/(en|nl)(\/|$)/, "/");
const pageId = path === "/" ? "" : path.replace(/^\/|\/$/g, "");

function urlForLocale(target: Lang) {
  // Astro docs: getRelativeLocaleUrl(locale, pageId)
  return getRelativeLocaleUrl(target, pageId);
}
---

<div class="flex items-center gap-2" aria-label="Choose language">
  {Object.entries(languages).map(([code, label]) => {
    const isActive = code === lang;
    return (
      <a
        href={urlForLocale(code as Lang)}
        class={`text-xs uppercase tracking-wide ${
          isActive ? "font-bold underline" : "opacity-70 hover:opacity-100"
        }`}
        aria-current={isActive ? "page" : undefined}
      >
        {label}
      </a>
    );
  })}
</div>

